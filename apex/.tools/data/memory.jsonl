{"type":"entity","name":"ProxyNow","entityType":"Project","observations":["High-performance Rust reverse proxy","Target: 3-5x faster than Traefik","Combines nginx data plane efficiency with Traefik dynamic config","Memory safety at compile-time","Estimated effort: 12-16 weeks (3 phases)"]}
{"type":"entity","name":"PerformanceInvariants","entityType":"Constraint","observations":["BANNED: Mutex/RwLock in hot path","BANNED: Allocation per-request (except arena)","BANNED: Box<dyn Service> in core stack","BANNED: Blocking I/O","BANNED: Clone headers/body","BANNED: panic!/unwrap on user input","REQUIRED: Lock-free config reads (ArcSwap)","REQUIRED: Zero-copy buffers (bytes::Bytes)","REQUIRED: Per-request arena (bumpalo)","REQUIRED: Generic middleware (Tower Layer<S>)","REQUIRED: Lock-free TLS cache (DashMap)","REQUIRED: Hot/cold struct separation"]}
{"type":"entity","name":"PerformanceGates","entityType":"Metric","observations":["Phase 1: >100k RPS, P50 <100μs, P99 <500μs, >=1.5x Traefik","Phase 2: >200k RPS, P50 <50μs, P99 <200μs, >=3x Traefik","Phase 3: >300k RPS, P50 <30μs, P99 <100μs, >=5x Traefik","Not meeting gates = No ship"]}
{"type":"entity","name":"WorkspaceStructure","entityType":"Architecture","observations":["Multi-crate workspace for independent builds","proto crate: #![no_std], STABLE ABI, error codes","core crate: HOT PATH, minimal deps, RequestContext","lb crate: Load balancing algorithms","pool crate: Connection pooling","tls crate: TLS + ACME","middleware crate: Tower layers","metrics crate: Prometheus, tracing","config crate: Config parsing, hot reload","server crate: HTTP server, handler","proxy-now crate: Binary, CLI"]}
{"type":"entity","name":"TraefikBottlenecks","entityType":"Analysis","observations":["Bottleneck #1: Lock contention (5-15% CPU) - TLS, LB, Transport","Bottleneck #2: Per-request GC allocations (2-5% CPU)","Bottleneck #3: O(n) route matching (50-100μs @ 1000 routes)","Bottleneck #4: Middleware chain overhead (2-5μs/request)","Bottleneck #5: Config reload locking (100-500μs spike)"]}
{"type":"entity","name":"ProxyTouchPoints","entityType":"Analysis","observations":["Total: 25 touch points for request-response cycle","Kernel I/O: ~15μs (10%)","TLS operations: ~100μs (65%) - BIGGEST BOTTLENECK","HTTP parsing: ~5μs (3%)","Routing + Middleware: ~10μs (7%)","Serialization: ~5μs (3%)","Memory copy: ~15μs (10%)"]}
{"type":"entity","name":"CriticalIssues","entityType":"Risk","observations":["Arena + Async = Lifetime nightmare (70% likelihood)","Box<dyn AsyncReadWrite> violates invariant #3","Performance targets lack real baseline","ConnectionPool sync vs async mismatch","hyper::Body zero-copy claim inaccurate","Timeline estimates too optimistic"]}
{"type":"entity","name":"TechStack","entityType":"Dependency","observations":["tokio 1.x - Async runtime","hyper 1.x - HTTP client/server","rustls 0.23 - TLS","arc-swap 1.x - Lock-free config swap","dashmap 6.x - Concurrent hashmap","bumpalo 3.x - Arena allocator","tower 0.4 - Middleware framework","bytes 1.x - Zero-copy buffers","instant-acme - ACME client","MSRV: Rust 1.75"]}
{"type":"entity","name":"Phase1Tasks","entityType":"Milestone","observations":["HTTP/1.1 reverse proxy","Static config","Target: >100k RPS","Tasks: scaffold, config, RequestContext, router, pool, server, TLS, LB, metrics, benchmark, shutdown","Duration: 4-5 weeks"]}
{"type":"entity","name":"Phase2Tasks","entityType":"Milestone","observations":["Auto TLS with ACME","Hot reload config","Dynamic routing (radix tree)","Target: >200k RPS","Duration: 4-5 weeks"]}
{"type":"entity","name":"Phase3Tasks","entityType":"Milestone","observations":["Per-worker connection pool","io_uring support","WASM plugins","HTTP/3 QUIC","Target: >300k RPS, 5x Traefik","Duration: 4-5 weeks"]}
{"type":"entity","name":"DecisionLog","entityType":"Decision","observations":["2026-01-27: Lock-free data plane mandatory","2026-01-27: Zero-copy + arena buffer model","2026-01-27: HTTP/1.1 only Phase 1","2026-01-27: ConnectionPool trait abstraction","2026-01-27: Invariants = hard law","2026-01-27: Sequential router MVP with metrics","2026-01-28: DashMap for TLS cache","2026-01-28: Multi-crate workspace structure"]}
{"type":"entity","name":"Phase1-Scaffold","entityType":"Milestone","observations":["2026-01-28: Completed initial scaffold","Created 4 crates: apex, core, config, server","14 unit tests passing","Build successful with release profile","Stack: tokio 1.x, hyper 1.x, rustls 0.23, arc-swap 1.x","Lock-free routing with DashMap + ArcSwap","Zero-copy backend pool with atomic operations","2026-01-28: First benchmark results","Backend direct: 77k RPS @ 1.3ms latency","Apex proxy: 31k RPS @ 3.2ms latency (100 concurrent)","Proxy overhead: ~40% throughput reduction","Key optimization: Remove per-request logging -> 5x improvement","Connection pool: 512 max idle per host, 90s timeout","Next: Streaming body to reduce buffering overhead"]}
{"type":"entity","name":"HTTP2Breakthrough","entityType":"Analysis","observations":["2026-01-28: HTTP/2 multiplexing achieves 59.3k RPS vs 33k HTTP/1.1","Lock-free design is critical - Mutex version only got 26k RPS","HTTP/2 SendRequest is Clone-able and thread-safe","Pre-connect to backend eliminates handshake overhead per request","Single HTTP/2 connection handles 1000+ concurrent streams","Phase 1 target (60k RPS) effectively achieved","Apex HTTP/2 integrated: 52.5k RPS vs 33k HTTP/1.1 (+60%)","Standalone benchmark: 59k RPS (higher due to less overhead)","HTTP/2 mode enabled via --http2 flag","Backend HTTP/2 connection pooled per SocketAddr"]}
{"type":"relation","from":"ProxyNow","to":"PerformanceInvariants","relationType":"must_follow"}
{"type":"relation","from":"ProxyNow","to":"PerformanceGates","relationType":"must_achieve"}
{"type":"relation","from":"ProxyNow","to":"WorkspaceStructure","relationType":"organized_by"}
{"type":"relation","from":"ProxyNow","to":"TechStack","relationType":"uses"}
{"type":"relation","from":"ProxyNow","to":"TraefikBottlenecks","relationType":"addresses"}
{"type":"relation","from":"PerformanceInvariants","to":"TraefikBottlenecks","relationType":"designed_to_solve"}
{"type":"relation","from":"Phase1Tasks","to":"PerformanceGates","relationType":"targets"}
{"type":"relation","from":"Phase2Tasks","to":"PerformanceGates","relationType":"targets"}
{"type":"relation","from":"Phase3Tasks","to":"PerformanceGates","relationType":"targets"}
{"type":"relation","from":"CriticalIssues","to":"ProxyNow","relationType":"threatens"}
{"type":"relation","from":"DecisionLog","to":"ProxyNow","relationType":"documents"}
{"type":"relation","from":"ProxyTouchPoints","to":"TraefikBottlenecks","relationType":"informs"}